<?xml version="1.0" encoding="UTF-8"?>
<record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[function($scope, $http, $window, spScUtil, nowAttachmentHandler, spUtil, $log, spAriaUtil, $rootScope,$timeout) {
  
	

  /* widget controller */

  var c = this;
/* used for talking to widgets
  $scope.showWidget = "";

        //Listening for "showHideWidget" event

  $rootScope.$on('showHideWidget', function(event,data) {

  $timeout(function(){

            $scope.showWidget = data;

  });

  });
	
	*/
	
	/******************************************************************
	 ********************** BEGIN c.readReviews ***********************
	 ******************************************************************
		This function gets called by button click inside html.
		------------------------------------------------------
		On Show Reviews Button Click:
		Check to see if a course is selected.
			If not throw error message and exit function.
		Otherwise update c.data.myCourseName to selected course name 
										 (input.myCourseName inside Server Script)
		Then update server: re-run entire server script
	********************************************************************/
	c.readReviews = function() {
		
		if(c.courseName.value == undefined) {
			spUtil.addErrorMessage('You must select a course to see its reviews.');
			return;
		}
		
		c.data.myCourseName = c.courseName.value;
		c.server.update();
	}
	
	/******************************************************************
	 *********************** END c.readReviews ************************
	 *****************************************************************/

	/*
	c.cancel = function() {
		// maybe you can close widget to make screen larger
		$rootScope.$broadcast("$sp.service_catalog.cart.place_order", true);
	} 
	*/
	
	
}]]></client_script>
        <controller_as>c</controller_as>
        <css>/////menu pills vvvvvvvvvvvv

.center-div{

      margin-left: auto;

      margin-right: auto;

  float:none;

}
/////////////////////////////////
.wordwrap
{   
    width: 415px;
    word-wrap: break-word;
}

.attachment-list {
  	max-height: 180px;
  	overflow-y: scroll;
  	margin-bottom: 10px;
}

.accordion-toggle {
  	line-height: 13px;
}

textarea {
	resize: vertical;
}

.select2-additional-display-field {
  	padding-right: 5px;
}



div.image {
height: 200px;
width: 400px;
top: 99px;
left: 50px;
background-size: cover;
}

/* border at bottom of tabs */
.nav-tabs {
 	border:none; 
}

/* tab selected background color */
.nav-tabs &gt; li.active &gt; a, .nav-tabs &gt; li.active &gt; a:hover, .nav-tabs &gt; li.active &gt; a:focus {
    color: #555555;
    background-color: #ffffff;
}
/* hard coded to match write a review widget original size */
.panel {
 min-height: 405px;
 //max-width: 600px;
}
-- ICON LINK CSS BEGIN:--------------------------------------------------------

.iconlink a label,h2 {
  display: block;
  font-size: 2.5rem;
  font-weight: 300;
  line-height: 1.1;
  padding: 0;
  margin: 0 0 10px 0;
}

/* TOP ICON ---------- */

a.top_icon {
  display: block;
  padding: 20px;
  text-align: center;
}

a.top_icon .fa {
  display: block;
  text-align: center;
}

/* CIRCLE ICON ---------- */

a.circle_icon {
  display: block;
  padding: 20px 0px 20px 70px;
  position: relative;
}

a.circle_icon .fa {
  position:absolute;
  left: 0px;
  top: 10px;
}

/* COLOR BOX ---------- */

a.color_box {
  display: block;
  position: relative;
  padding: 20px 20px 20px 82px;
  border-radius: 4px;
  margin-bottom: 20px;
}

a.color_box .fa {
  position:absolute;
  left: 20px;
  top: 20px;
  width:42px;
  text-align: center;
}

.icon-link-background-primary {
  background-color: $brand-primary;
}

.icon-link-background-info {
  background-color: $brand-info;
}

.icon-link-background-success {
  background-color: $brand-success;
}

.icon-link-background-warning {
  background-color: $brand-warning;
}

.icon-link-background-danger {
  background-color: $brand-danger;
}

.icon-link-background-default {
  background-color: $brand-primary;
}

.text-primary {
  color: $brand-primary;
  
  &amp;:hover {
    color: darken($brand-primary, 20%);
  }
}

.text-info {
  color: $brand-info;
  
  &amp;:hover {
    color: darken($brand-info, 20%);
  }
}

.text-success {
  color: $brand-success;
  
  &amp;:hover {
    color: darken($brand-success, 20%);
  }
}

.text-warning {
  color: $brand-warning;
  
  /*
  &amp;:hover {
    color: darken($brand-warning, 20%);
  }
  */
}

.text-danger {
  color: $brand-danger;
  
  &amp;:hover {
    color: darken($brand-danger, 20%);
  }
}

.text-default {
  color: $brand-primary;
  
  &amp;:hover {
    color: darken($brand-primary, 20%);
  }
}
-- ICON LINK CSS END:--------------------------------------------------------</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>true</has_preview>
        <id>see-reviews-widget</id>
        <internal>false</internal>
        <link/>
        <name>See Reviews Widget</name>
        <option_schema/>
        <public>true</public>
        <roles/>
        <script><![CDATA[(function() {
	
	// data is an object accessible within whole widget 
	// requestList holds all of the queried review information for each review used in html file with ng-repeat
	data.requestList = [];
	data.countAllStarsSubmittedForCourse = 0;
	data.countAllReviewsSubmittedForCourse = 0;
	data.overallCourseRating = 0;
	data.courseAddress = "";
	data.coursePhoneNumber = "";
	
	//gs.addInfoMessage(data.starValue);
	//gs.addInfoMessage(data.action);
	//gs.addInfoMessage(options.action);
	//gs.addInfoMessage(input + "input");

	/******************************************************************
	 ************************ BEGIN readReviews ***********************
	 ******************************************************************
		This function gets called by server update 
			 in client script function c.readReviews
		------------------------------------------------------
		Queries golf course review table and searches by course name.
		Grabs course name, description, course rating for each review and
		pushes it to requestList which is visible within entire widget.
		Keeps track of average star rating for each review to show an 
		overall course rating.
		
		Queries golf course select for general information to provide with overall review.
	********************************************************************/
if(input && input.action == 'readreviews') {
	
	// This table holds all the reviews for golf courses
	var target = new GlideRecord('x_339628_fairfaxco_golf_course_reviews_2') ; 
	target.addQuery('course_name','=',input.myCourseName);
	target.orderByDesc('sys_created_on');
	target.query(); // Issue the query to the database to get relevant records 
	while (target.next()) { 
  
		var temp = {};

		temp.course_name = target.course_name.toString();
		temp.description = target.description.toString();
		temp.course_rating = target.course_rating.toString();
		temp.date = target.sys_created_on.toString();

		data.requestList.push(temp);
	
		data.countAllStarsSubmittedForCourse += Number(temp.course_rating);
		data.countAllReviewsSubmittedForCourse++;
		
		//gs.addInfoMessage("All Stars: " + data.countAllStarsSubmittedForCourse + " # of Reviews: " + data.countAllReviewsSubmittedForCourse);
	}
	
	data.overallCourseRating = Math.round(data.countAllStarsSubmittedForCourse / data.countAllReviewsSubmittedForCourse);
	//gs.addInfoMessage("Overall: " + data.overallCourseRating);
	
	// This table holds all of the golf courses and their basic info. (One of each course)
	// This is table used when selecting a course
	var newtarget = new GlideRecord('u_golf_courses'); 
	newtarget.addQuery('u_course_name','=',input.myCourseName);
	newtarget.query(); // Issue the query to the database to get relevant records 
	while (newtarget.next()) {
		data.coursePicture = newtarget.u_picture.getDisplayValue().toString();
		data.courseAddress = newtarget.u_address.toString();
		data.coursePhoneNumber = newtarget.u_phone_number.toString();
	}
	//gs.addInfoMessage(data.coursePicture);
}
  /*****************************************************************
	 ************************ END readReviews ************************
	 *****************************************************************/
	
	// not sure if this is important
	/* curious if its best practice to put data.action = inside 
	   client script functions when server.updates are called */
	data.action = options.action;
	if (data.action)
		data.item = options.item;
	else
		//data.action = 'checkout';
		data.action = 'readreviews';
	
	
})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2019-06-21 15:16:25</sys_created_on>
        <sys_id>702f676f4f8a3300496900fe9310c79b</sys_id>
        <sys_mod_count>235</sys_mod_count>
        <sys_name>See Reviews Widget</sys_name>
        <sys_package display_value="FairfaxCounty" source="x_339628_fairfaxco">b1051ad14f413300496900fe9310c7cc</sys_package>
        <sys_policy/>
        <sys_scope display_value="FairfaxCounty">b1051ad14f413300496900fe9310c7cc</sys_scope>
        <sys_update_name>sp_widget_702f676f4f8a3300496900fe9310c79b</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2019-06-28 15:44:36</sys_updated_on>
        <template><![CDATA[<!-- -------------------------------------------------- -->
<!-- ---------------- Tab Information ----------------- -->
<!-- -------------------------------------------------- ---

		A lot of tab stuff not used. Notice there is only 2 tabs.
		"write a review and see all reviews"
-- ---------------------------------------------------- --
	<uib-tabset active="active">
    <uib-tab index="0" heading="Write a Review"></uib-tab>
    <uib-tab index="$index + 1" ng-repeat="tab in tabs" heading="{{tab.title}}" disable="tab.disabled">
      {{tab.content}}
    </uib-tab>
    <uib-tab index="3" select="alertMe()" >
      <uib-tab-heading>
        <i class="glyphicon glyphicon-bell"></i> See all Reviews
      </uib-tab-heading>
      !--I've got an HTML heading, and a select callback. Pretty cool --
    </uib-tab>
  </uib-tabset>

id= see-reviews-widget
!-- --------------------------------------------------------------------------------- --


<div ng-if="showWidget == 'see-reviews-widget'">
<div class="container">

-->


<div class="panel panel-default" min-height="900px">
	<h1 class="padder-md h3">${View Golf Courses Reviews}
    <span class="text-base">
  	  <i class="fa fa-close pull-right text-base" ng-click="c.cancel()"></i>
     </span>
  </h1>
	<div class="wrapper-md clearfix b-t">
		<div class="form-group">
			<div class="row">
				<div class="col-sm-8">
					<label for="u_course_name">${Select a Course} <i class="fa fa-info-circle" uib-tooltip="${Please select a course to see reviews.}" tooltip-placement="right" tooltip-append-to-body="true"></i></label>
					<!-- -------------------------------------------------- -->
  				<!-- ----------- Reference Search Bar ----------------- -->
 				  <!-- -------------------------------------------------- -->
          <sn-record-picker id="u_course_name" 
                            field="c.courseName" 
                            table="'u_golf_courses'" 
                            display-field="'u_course_name'" 
                            value-field="'u_course_name'"
                            page-size="100" 
                           >
          </sn-record-picker>
          									<!-- These attributes were pulled out of sn-record-picker -->

          									<!-- value-field="'sys_id'" -->
          									<!-- sn-disabled="!c.data.disable_req_for" -->
											 			<!-- search-fields="c.data.reqForDispCols"
                            		 default-query="c.data.reqForQuery"
          											 display-fields="c.data.reqForDispCols" -->
				</div>
    
      
 </div>
   
		</div>

     <button name="submit" ng-click="c.readReviews()" class="btn sc-btn btn-primary pull-right m-l-xs">
  ${Show Reviews}
  </button>
    </div>
  
  <!-- -------------------------------------------------- -->
  <!-- ----------- BEGIN overall course review ---------- -->
  <!-- -------------------------------------------------- -->
  
  <div ng-if="data.overallCourseRating > 0">
     <h1 class="padder">{{data.myCourseName}}</h1>
     <h5 class="padder" >Overall Review</h5>
 
     <div ng-if="data.overallCourseRating == 1" class="col-sm-12" id="StarRatingView">
          
         	 <div id="1Star" class="m-b fa fa-star fa-4x  text-warning"></div>
        	 <div id="2Star" class="m-b fa fa-star-o fa-4x  text-warning"></div>
        	 <div id="3Star" class="m-b fa fa-star-o fa-4x  text-warning"></div>
             <div id="4Star" class="m-b fa fa-star-o fa-4x  text-warning"></div>
        	 <div id="5Star" class="m-b fa fa-star-o fa-4x  text-warning"></div>
         
        </div>
      <div ng-if="data.overallCourseRating == 2" class="col-sm-12" id="StarRatingView">
          
         	 <div id="1Star" class="m-b fa fa-star fa-4x  text-warning"></div>
        	 <div id="2Star" class="m-b fa fa-star fa-4x  text-warning"></div>
        	 <div id="3Star" class="m-b fa fa-star-o fa-4x  text-warning"></div>
             <div id="4Star" class="m-b fa fa-star-o fa-4x  text-warning"></div>
        	 <div id="5Star" class="m-b fa fa-star-o fa-4x  text-warning"></div>
         
        </div>
      <div ng-if="data.overallCourseRating == 3" class="col-sm-12" id="StarRatingView">
          
         	 <div id="1Star" class="m-b fa fa-star fa-4x  text-warning"></div>
        	 <div id="2Star" class="m-b fa fa-star fa-4x  text-warning"></div>
        	 <div id="3Star" class="m-b fa fa-star fa-4x  text-warning"></div>
             <div id="4Star" class="m-b fa fa-star-o fa-4x  text-warning"></div>
        	 <div id="5Star" class="m-b fa fa-star-o fa-4x  text-warning"></div>
         
        </div>
      <div ng-if="data.overallCourseRating == 4" class="col-sm-12" id="StarRatingView">
          
         	 <div id="1Star" class="m-b fa fa-star fa-4x  text-warning"></div>
        	 <div id="2Star" class="m-b fa fa-star fa-4x  text-warning"></div>
        	 <div id="3Star" class="m-b fa fa-star fa-4x  text-warning"></div>
             <div id="4Star" class="m-b fa fa-star fa-4x  text-warning"></div>
        	 <div id="5Star" class="m-b fa fa-star-o fa-4x  text-warning"></div>
         
        </div>
      <div ng-if="data.overallCourseRating == 5" class="col-sm-12" id="StarRatingView">
          
         	 <div id="1Star" class="m-b fa fa-star fa-4x  text-warning"></div>
        	 <div id="2Star" class="m-b fa fa-star fa-4x  text-warning"></div>
        	 <div id="3Star" class="m-b fa fa-star fa-4x  text-warning"></div>
             <div id="4Star" class="m-b fa fa-star fa-4x  text-warning"></div>
        	 <div id="5Star" class="m-b fa fa-star fa-4x  text-warning"></div>
         
        </div>
		
		<!-- this loads as background so you can paste content onto it
				<div class="image padder" style="background: url('{{data.coursePicture}}') center center;background-size: cover;"></div> -->
  <img src="{{data.coursePicture}}" width="400" height="250"/>
		
    </div>
  
        
    

  <br />
   
  <div class="row padder" ng-if="data.overallCourseRating > 0">
		<div class="col-xs-2" >Address:</div>
		<div class="col-xs-10" >{{data.courseAddress}}</div>  
		<div class="col-xs-2" >Phone:</div>
		<div class="col-xs-10" >{{data.coursePhoneNumber}}</div>
 
</div>
  
  <!-- -------------------------------------------------- -->
  <!-- ----------- END overall course review ------------ -->
  <!-- -------------------------------------------------- -->
  
  <!-- -------------------------------------------------- -->
  <!-- ----------- BEGIN repeat all reviews ------------- -->
  <!-- -------------------------------------------------- -->
   <div ng-repeat="review in data.requestList | limitTo:50" class="each-incident">    
      
      <hr /> 
      <h1 class="padder">{{review.course_name}}</h1>
     
        <div ng-if="review.course_rating == 1" class="col-sm-12" id="StarRatingView">
          
         	 <div id="1Star" class="m-b fa fa-star fa-3x  text-warning"></div>
        	 <div id="2Star" class="m-b fa fa-star-o fa-3x  text-warning"></div>
        	 <div id="3Star" class="m-b fa fa-star-o fa-3x  text-warning"></div>
           <div id="4Star" class="m-b fa fa-star-o fa-3x  text-warning"></div>
        	 <div id="5Star" class="m-b fa fa-star-o fa-3x  text-warning"></div>
         
        </div>
      <div ng-if="review.course_rating == 2" class="col-sm-12" id="StarRatingView">
          
         	 <div id="1Star" class="m-b fa fa-star fa-3x  text-warning"></div>
        	 <div id="2Star" class="m-b fa fa-star fa-3x  text-warning"></div>
        	 <div id="3Star" class="m-b fa fa-star-o fa-3x  text-warning"></div>
           <div id="4Star" class="m-b fa fa-star-o fa-3x  text-warning"></div>
        	 <div id="5Star" class="m-b fa fa-star-o fa-3x  text-warning"></div>
         
        </div>
      <div ng-if="review.course_rating == 3" class="col-sm-12" id="StarRatingView">
          
         	 <div id="1Star" class="m-b fa fa-star fa-3x  text-warning"></div>
        	 <div id="2Star" class="m-b fa fa-star fa-3x  text-warning"></div>
        	 <div id="3Star" class="m-b fa fa-star fa-3x  text-warning"></div>
           <div id="4Star" class="m-b fa fa-star-o fa-3x  text-warning"></div>
        	 <div id="5Star" class="m-b fa fa-star-o fa-3x  text-warning"></div>
         
        </div>
      <div ng-if="review.course_rating == 4" class="col-sm-12" id="StarRatingView">
          
         	 <div id="1Star" class="m-b fa fa-star fa-3x  text-warning"></div>
        	 <div id="2Star" class="m-b fa fa-star fa-3x  text-warning"></div>
        	 <div id="3Star" class="m-b fa fa-star fa-3x  text-warning"></div>
           <div id="4Star" class="m-b fa fa-star fa-3x  text-warning"></div>
        	 <div id="5Star" class="m-b fa fa-star-o fa-3x  text-warning"></div>
         
        </div>
      <div ng-if="review.course_rating == 5" class="col-sm-12" id="StarRatingView">
          
         	 <div id="1Star" class="m-b fa fa-star fa-3x  text-warning"></div>
        	 <div id="2Star" class="m-b fa fa-star fa-3x  text-warning"></div>
        	 <div id="3Star" class="m-b fa fa-star fa-3x  text-warning"></div>
           <div id="4Star" class="m-b fa fa-star fa-3x  text-warning"></div>
        	 <div id="5Star" class="m-b fa fa-star fa-3x  text-warning"></div>
         
        </div>
     <br /><br /><br />
      <!--
			<p class="padder">{{review.course_rating}}</p>
			-->
      <p class="padder wordwrap">{{review.description}}</p>
     
   
     <!--	{{review.default_stars}} -->
    	<br />
			
      <p style="color:#BBBBBB; margin-bottom:0px;" class="padder pull-right">{{review.date}}</p>

  </div> 
  
  <!-- -------------------------------------------------- -->
  <!-- ------------- END repeat all reviews ------------- -->
  <!-- -------------------------------------------------- -->
  
	</div>
<!--
</div>
</div>
-->]]></template>
    </sp_widget>
</record_update>
